<div class="form-field-wrapper" [style.max-width]="maxWidth()">
  <!-- LABEL -->
  <label class="custom-field-label">
    {{ label() }}
  </label>

  <!-- CONTAINER DEL INPUT -->
  <div class="input-container" [class.focused]="isFocused" [class.filter-style]="filterStyle()">
    <!-- CHIPS SELECCIONADOS -->
    <div #chipsContainer class="chips-container" [class.has-max-width]="!!maxWidth()">
      @for (tag of selectedTags(); track tag.id; let i = $index) {
      @if (shouldShowChip(i)) {
      <div class="chip" [style.background-color]="getTagColor(tag)" [style.color]="getTextColor(getTagColor(tag))">
        {{ getTagName(tag, currentLanguage()) }}
        <button type="button" class="chip-remove" (click)="removeTag(tag.id!); $event.stopPropagation()"
          [style.color]="getTextColor(getTagColor(tag))">
          ✕
        </button>
      </div>
      }
      }

      <!-- INDICADOR DE TAGS OCULTAS -->
      @if (maxWidth() && hiddenTagsCount() > 0 && !isFocused) {
      <div class="overflow-indicator">
        +{{ hiddenTagsCount() }}
      </div>
      }

      <!-- INPUT DE BÚSQUEDA -->
      <input #chipInput type="text" class="chip-input" [placeholder]="value().length === 0 && !isFocused ? '' : ''"
        (focus)="onFocus()" (blur)="onBlur()" (input)="onSearchInput($event)" [value]="searchTerm" />
    </div>

    <!-- DROPDOWN DE OPCIONES -->
    @if (showDropdown && filteredTags().length > 0) {
    <div class="dropdown" (click)="$event.stopPropagation()">
      @for (tag of filteredTags(); track tag.id) {
      <div class="dropdown-item" (click)="addTag(tag); $event.stopPropagation()">
        <div class="dropdown-chip" [style.background-color]="getTagColor(tag)"
          [style.color]="getTextColor(getTagColor(tag))">
          {{ getTagName(tag, currentLanguage()) }}
        </div>
      </div>
      }
    </div>
    }
  </div>
</div>